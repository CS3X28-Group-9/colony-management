{% extends "base.html" %}
{% block title %}Import form{% endblock %}
{% block content %}

  <div
    class="p-4 m-4 sm:p-6 lg:p-8 rounded bg-neutral-200 w-max shadow-md border border-neutral-300"
  >
    <h1>Mouse Excel Import</h1>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="relative flex items-center">
        <label for="select" class="whitespace-nowrap text-sm"> Project: </label>

        <el-select
          id="{{ form.project.id_for_label }}"
          name="{{ form.project.html_name }}"
          class="mt-2 block"
        >
          <button
            type="button"
            class="flex w-50 items-center justify-between rounded-md bg-white py-1.5 px-3 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-blue-600 sm:text-sm"
          >
            <el-selectedcontent class="col-start-1 row-start-1 flex items-center">
              <span class="truncate">Select a project!</span>
            </el-selectedcontent>
            {% include "components/svgs/double-chevron.svg" %}
          </button>

          <el-options
            anchor="bottom end"
            popover
            class="max-h-56 w-(--button-width) overflow-auto rounded-md bg-white py-1 text-base shadow-lg outline-1 outline-black/5 [--anchor-gap:--spacing(1)] data-leave:transition data-leave:transition-discrete data-leave:duration-100 data-leave:ease-in data-closed:data-leave:opacity-0 sm:text-sm"
          >{% for project in user.leading_set.all %}
            <el-option
              value="{{ project.id }}"
              class="group/option relative block cursor-default py-2 pr-9 pl-3 text-gray-900 select-none focus:bg-blue-600 focus:text-white focus:outline-hidden"
            >
              <div class="flex items-center">
                <span
                  class="ml-3 block truncate font-normal group-aria-selected/option:font-semibold"
                >{{ project.name }}</span
                  >
                </div>
                <span
                  class="absolute inset-y-0 right-0 flex items-center pr-4 text-blue-600 invisible group-aria-selected/option:visible group-focus/option:text-white"
                >
                  {% include "components/svgs/selected.svg" %}
                </span>
              </el-option>
          {% endfor %}
          </el-options>
        </el-select>
      </div>
      {% if form.project.errors %}
        <div class="error-message-compact">
          {% for error in form.project.errors %} {{ error }} {% endfor %}
        </div>
      {% endif %}

      <br />
      <label for="file-input" class="sr-only">Choose file</label>
      <input
        type="file"
        id="{{ form.file.id_for_label }}"
        name="{{ form.file.html_name }}"
        class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all file:mr-4 file:py-2.5 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed"
        required
      />
      {% if form.file.errors %}
        <div class="error-message-compact">
          {% for error in form.file.errors %} {{ error }} {% endfor %}
        </div>
      {% endif %}

      <br />
      <label for="{{ form.sheet_name.id_for_label }}" class="block text-sm font-medium text-gray-700">
        Sheet name
        <span class="text-gray-500 font-normal">- Leave blank to use the active worksheet</span>
      </label>
      <input
        type="text"
        id="{{ form.sheet_name.id_for_label }}"
        name="{{ form.sheet_name.html_name }}"
        class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
        placeholder="e.g., Sheet1"
      />
      {% if form.sheet.errors %}
        <div class="error-message-compact">
          {% for error in form.cell_range.errors %} {{ error }} {% endfor %}
        </div>
      {% endif %}
      <br />
      <label for="{{ form.cell_range.id_for_label }}" class="block text-sm font-medium text-gray-700">
        Cell range
        <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="{{ form.cell_range.id_for_label }}"
        name="{{ form.cell_range.html_name }}"
        class="block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
        placeholder="e.g., A1:M40"
        required
      />
      <p class="text-xs text-gray-500">Excel range such as "A1:M40"</p>
      {% if form.cell_range.errors %}
        <div class="error-message-compact">
          {% for error in form.cell_range.errors %} {{ error }} {% endfor %}
        </div>
      {% endif %}

      {% if messages %}
        {% for message in messages %}
          {% if 'range_error' in message.tags %}
            <div class = "error-message-compact">{{ message }}</div>
          {% endif %}
        {% endfor %}
      {% endif %}
      <br>

      {% if form.non_field_errors %} {% for error in form.non_field_errors %}
        <p class="error-message text-center">{{ error }}</p>
      {% endfor %} {% endif %}

      <button type="submit" class="btn-primary">Upload</button>
    </form>
  </div>

{% endblock %}
