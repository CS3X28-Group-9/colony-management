{% extends "base.html" %}
{% block title %}
  Create {{ request_type }} Request
{% endblock %}
{% block content %}
  <div class="max-w-2xl mx-auto mt-6">
    <div class="card">
      <h1 class="page-title">
        Create {{ request_type|lower }} request
        {% if project %}- {{ project.name }}{% endif %}
      </h1>
      {% if mouse %}
        <p class="text-sm text-neutral-600 mt-1">
          {{ mouse.strain }} - Tube {{ mouse.tube_number }}
        </p>
      {% endif %}

      <form method="post">
        {{ csrf_input }} {{ form.kind }}
        {% if project %}
          <input type="hidden" name="project" value="{{ project.id }}" />
        {% elif request.GET.project %}
          <input
            type="hidden"
            name="project"
            value="{{ request.GET.project }}"
          />
        {% endif %}
        {% if mouse_id %}
          <input type="hidden" name="mouse" value="{{ mouse_id }}" />
        {% endif %}
        {% if form.errors %}
          <div class="error-message">
            <h3 class="text-red-800 font-semibold mb-2">
              Please correct the following errors:
            </h3>
            {% if form.non_field_errors %}
              <ul class="list-disc list-inside text-red-700 mb-2">
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            {% endif %}
            {% for field in form %}{% if field.errors %}
              <p class="text-red-700">
                <strong>{{ field.label }}:</strong>
                {% for error in field.errors %}{{ error }}{% endfor %}
              </p>
            {% endif %}{% endfor %}
          </div>
        {% endif %}

        <div class="space-y-4">
          {% if not mouse_id %}
            <div>
              <label
                for="{{ form.mouse.id_for_label }}"
                class="block text-sm font-medium text-neutral-800 mb-1"
              >
                {{ form.mouse.label }}
              </label>
              {{ form.mouse }}
              {% if form.mouse.errors %}
                <p class="mt-1 error-message-compact">
                  {{ form.mouse.errors }}
                </p>
              {% endif %}
              {% if form.mouse.help_text %}
                <p class="mt-1 text-sm text-neutral-700 font-medium">
                  {{ form.mouse.help_text }}
                </p>
              {% endif %}
            </div>
          {% endif %}

          <div>
            <label
              for="{{ form.details.id_for_label }}"
              class="block text-sm font-medium text-neutral-800 mb-1"
            >
              {{ form.details.label }}
            </label>
            {{ form.details }}
            {% if form.details.errors %}
              <p class="mt-1 error-message-compact">
                {{ form.details.errors }}
              </p>
            {% endif %}
            {% if form.details.help_text %}
              <p class="mt-1 text-sm text-neutral-700 font-medium">
                {{ form.details.help_text }}
              </p>
            {% endif %}
          </div>
        </div>

        <div class="mt-6 flex gap-3">
          <button type="submit" class="btn-primary">Create Request</button>
          {% if mouse_id %}
            <a
              href="{{ url('mouseapp:mouse', mouse_id) }}"
              class="btn-secondary"
              >Cancel</a
            >
          {% elif project %}
            <a
              href="{{ url('mouseapp:project', project.id) }}"
              class="btn-secondary"
              >Cancel</a
            >
          {% else %}
            <a href="{{ url('mouseapp:requests') }}" class="btn-secondary"
              >Cancel</a
            >
          {% endif %}
        </div>
      </form>
    </div>
  </div>
{% endblock %}
