<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="{{ width }}" height="{{ height }}" viewBox="{{ viewbox }}" xmlns="http://www.w3.org/2000/svg" version="1.1">
    <style>
        .edge { stroke: black; stroke-width: 2px; }
        .box  { fill: white; stroke: #e5e7eb; stroke-width: 1px; }
        text  { font-family: sans-serif; }
        .txt-strain { font-size: 14px; fill: #2563eb; font-weight: bold; cursor: pointer; }
        .txt-info   { font-size: 14px; fill: black; }
        .txt-link   { font-size: 10px; fill: #2563eb; text-anchor: end; cursor: pointer; }
        a:hover text { fill: #1d4ed8; text-decoration: underline; }
        /* Style hooks for interaction */
        .node, .edge { transition: opacity 0.2s; }
        .dimmed { opacity: 0.1; }
        .highlight { opacity: 1 !important; }
    </style>

    <g id="edges">
    {% for edge in edges %}
    <path
        d="{{ edge.d }}"
        fill="none"
        class="edge"
        data-child-id="node-{{ edge.child_id }}"
    />
    {% endfor %}
    </g>


    <g id="nodes">
    {% for node in nodes %}
        <g class="node" id="node-{{ node.id }}"
           data-father="node-{{ node.father_id }}"
           data-mother="node-{{ node.mother_id }}"
           transform="translate({{ node.x }}, {{ node.y }})">
            <rect width="{{ box_w }}" height="{{ box_h }}" rx="6" class="box" />
            <a href="{{ node.tree_url }}" target="_top">
                <text x="8" y="20" class="txt-strain">{{ node.strain }}</text>
            </a>
            <text x="8" y="45" class="txt-info">{{ node.box_text }}</text>
            <text x="8" y="65" class="txt-info">{{ node.earmark_text }}</text>
            <a href="{{ node.detail_url }}" target="_top">
                <text x="{{ box_w - 8 }}" y="{{ box_h - 10 }}" class="txt-link">
                    (Details)
                </text>
            </a>
        </g>
    {% endfor %}
    </g>

    <script><![CDATA[
        document.addEventListener('DOMContentLoaded', () => {
            const nodes = document.querySelectorAll('.node'), edges = document.querySelectorAll('.edge');
            function highlight(id) {
                const n = document.getElementById(id);
                if (!n || id.includes('None')) return;
                n.classList.add('highlight');
                // This links the lines to the child currently being highlighted
                edges.forEach(e => { if(e.getAttribute('data-child-id') === id) e.classList.add('highlight'); });
                highlight(n.getAttribute('data-father'));
                highlight(n.getAttribute('data-mother'));
            }
            nodes.forEach(n => {
                n.addEventListener('mouseenter', () => {
                    nodes.forEach(x => x.classList.add('dimmed'));
                    edges.forEach(x => x.classList.add('dimmed'));
                    highlight(n.id);
                });
                n.addEventListener('mouseleave', () => {
                    nodes.forEach(x => x.classList.remove('dimmed', 'highlight'));
                    edges.forEach(x => x.classList.remove('dimmed', 'highlight'));
                });
            });
        });
    ]]></script>
</svg>
